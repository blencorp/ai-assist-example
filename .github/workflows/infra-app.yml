name: Application Infrastructure

on:
  push:
    paths:
      - "terraform/**"
      - "!terraform/ecr/**"
      - "!terraform/s3/**"
  workflow_dispatch:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

permissions:
  id-token: write # This is required for requesting the JWT
  contents: read # This is required for actions/checkout
  actions: read
  security-events: write

jobs:
  infra:
    name: Infra
    uses: department-of-veterans-affairs/cds-gha-workflows/.github/workflows/infra.yml@v7
    with:
      appName: ai-assist
      awsRoleArn: arn:aws:iam::123456789012:role/project/project-ai-assist-infra-role
      enableProd: false
      terraformWorkingDir: "terraform"
      terraformVersion: 1.12.0